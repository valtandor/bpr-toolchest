#!/bin/bash

BASENAME=/bin/basename
ECHO=/bin/echo
GETOPT=/usr/bin/getopt
HEAD=/usr/bin/head
ID=/usr/bin/id
#LLQ=/usr/bin/llq
SQUEUE=/usr/bin/squeue
TAIL=/usr/bin/tail

progname=$(${BASENAME} ${0})
jobids_only=false
wide=false

# Execute getopt
ARGS=$(${GETOPT} -o iu:w -l "jobids-only,user:,wide" -n "${progname}" -- "$@");

#Bad arguments
if [ $? -ne 0 ];
then
	exit 1
fi

eval set -- "$ARGS";

while true
do
	case "$1" in
	-i|--jobids-only)
		shift
		jobids_only=true
		;;
	-u|--user)
		shift
		if [ -n "$1" ]
		then
			user="$1"
			shift
		fi
		;;
	-w|--wide)
		shift
		wide=true
		;;
	--)
		shift
		break
		;;
	esac
done

me=$(${ID} -u -n)
if [ -z "${user}" ]
then
	user="${me}"
fi

if [ "${jobids_only}" = true ]
then
	${SQUEUE} -o "%i" -u ${user} | ${TAIL} -n +2 | ${HEAD} -n -3
else
	string="%.10i %.9P %.14j %.2t %.10M %.6D %R"
	if [ "${wide}" = true ]
	then
		string="%.12i %.9P %.24j %.2t %.10M %.6D %R"
	fi
	${SQUEUE} -o "${string}" -u ${user}
fi
